name: Deploy to EC2

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Build the project with Gradle
        run: |
          sudo su
          cd ~/Bigdate
          sudo ./gradlew build

      - name: Stop the previous process
        run: |
          PID=$(sudo lsof -i :8080 | grep -v PID | awk '{print $2}')
          if [ -n "$PID" ]; then
            echo "Stopping the previous process (PID: $PID)..."
            sudo kill $PID
          fi

      - name: Start the new process
        run: |
          cd build/libs
          nohup java -jar then-then-0.0.1-SNAPSHOT.jar&
